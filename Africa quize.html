<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ভূগোল কুইজ - Learner</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom CSS for quiz page */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Light blue-gray background */
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to top */
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }
        .quiz-container {
            background-color: #ffffff;
            padding: 2.5rem; /* 40px */
            border-radius: 1rem; /* 16px */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 800px;
            margin-top: 20px; /* Space from top */
        }
        .question-card {
            background-color: #e0f2fe; /* Light blue */
            padding: 1.5rem; /* 24px */
            margin-bottom: 1.5rem; /* 24px */
            border-radius: 0.75rem; /* 12px */
            border: 1px solid #90cdf4; /* Blue border */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        .question-text {
            font-size: 1.25rem; /* text-xl */
            font-weight: 600; /* font-semibold */
            color: #1a202c; /* gray-900 */
            margin-bottom: 1rem; /* 16px */
        }
        .option-label {
            display: flex;
            align-items: center;
            background-color: #ffffff;
            padding: 0.75rem 1rem; /* 12px 16px */
            border-radius: 0.5rem; /* 8px */
            margin-bottom: 0.5rem; /* 8px */
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            border: 1px solid #cbd5e0; /* gray-300 */
        }
        .option-label:hover {
            background-color: #f0f4f8; /* Light blue-gray on hover */
            border-color: #63b3ed; /* Blue-400 */
            transform: translateY(-2px);
        }
        .option-input[type="radio"] {
            margin-right: 0.75rem; /* 12px */
            accent-color: #3b82f6; /* Blue-500 */
            width: 1.25rem; /* 20px */
            height: 1.25rem; /* 20px */
        }
        .submit-button {
            background-color: #3b82f6; /* Blue-500 */
            color: white;
            padding: 0.75rem 1.5rem; /* 12px 24px */
            border-radius: 0.5rem; /* 8px */
            font-weight: 600; /* font-semibold */
            transition: background-color 0.2s ease-in-out, transform 0.2s ease-in-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .submit-button:hover {
            background-color: #2563eb; /* Blue-600 */
            transform: translateY(-2px);
        }
        .submit-button:active {
            transform: translateY(0);
            box-shadow: none;
        }
        .results-container {
            background-color: #ecfdf5; /* Light green */
            padding: 2rem; /* 32px */
            border-radius: 1rem; /* 16px */
            border: 1px solid #68d391; /* Green-400 */
            margin-top: 2rem; /* 32px */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .result-score {
            font-size: 2rem; /* text-3xl */
            font-weight: 700; /* font-bold */
            color: #065f46; /* Green-800 */
            text-align: center;
            margin-bottom: 1rem; /* 16px */
        }
        .answer-feedback {
            margin-top: 1.5rem; /* 24px */
            border-top: 1px solid #d1fae5; /* Green-100 */
            padding-top: 1.5rem; /* 24px */
        }
        .feedback-item {
            background-color: #f0fdf4; /* Lighter green */
            padding: 1rem; /* 16px */
            border-radius: 0.5rem; /* 8px */
            margin-bottom: 1rem; /* 16px */
            border: 1px solid #a7f3d0; /* Green-200 */
        }
        .feedback-item.correct .option-label {
            background-color: #d1fae5; /* Green-100 */
            border-color: #34d399; /* Green-400 */
        }
        .feedback-item.incorrect .option-label {
            background-color: #fee2e2; /* Red-100 */
            border-color: #ef4444; /* Red-500 */
        }
        .feedback-item .correct-answer-text {
            color: #065f46; /* Green-800 */
            font-weight: 600;
            margin-top: 0.5rem;
        }
        .feedback-item .wrong-answer-text {
            color: #dc2626; /* Red-600 */
            font-weight: 600;
            margin-top: 0.5rem;
        }
        .feedback-item .question-text-feedback { /* Specific class for question text in feedback */
            color: #10b981; /* Green-500 */
            font-weight: 700;
        }
        .explain-button {
            background-color: #6366f1; /* Indigo-500 */
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            margin-top: 0.75rem;
            transition: background-color 0.2s ease-in-out;
        }
        .explain-button:hover {
            background-color: #4f46e5; /* Indigo-600 */
        }
        .explanation-text {
            background-color: #eef2ff; /* Indigo-50 */
            border-left: 4px solid #818cf8; /* Indigo-300 */
            padding: 0.75rem 1rem;
            margin-top: 1rem;
            border-radius: 0.375rem;
            color: #4338ca; /* Indigo-700 */
            font-size: 0.9rem;
            line-height: 1.4;
            display: none; /* Hidden by default */
        }
        .explanation-text.show {
            display: block;
        }
        .loading-indicator {
            display: none;
            margin-top: 1rem;
            font-size: 0.9rem;
            color: #6b7280;
        }
        .loading-indicator.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="quiz-container">
        <h1 class="text-3xl font-bold text-center text-blue-700 mb-8">ভূগোল কুইজ</h1>
        <p class="text-center text-gray-600 mb-6">আপনার ভূগোল জ্ঞান পরীক্ষা করুন! প্রতিটি প্রশ্নের জন্য ১ নম্বর।</p>

        <form id="quizForm">
            <!-- Questions will be dynamically loaded here by JavaScript -->
        </form>

        <div class="flex justify-center mt-8">
            <button id="submitQuiz" class="submit-button">কুইজ জমা দিন</button>
        </div>

        <div id="quizResults" class="results-container hidden">
            <h2 class="text-2xl font-bold text-center text-green-700 mb-4">আপনার ফলাফল</h2>
            <p class="result-score">আপনি পেয়েছেন: <span id="scoreDisplay">0</span>/<span id="totalQuestions">20</span></p>
            <div id="answerFeedback" class="answer-feedback">
                <!-- Answer feedback will be displayed here -->
            </div>
            <div class="flex justify-center mt-6">
                <button id="retakeQuiz" class="submit-button bg-purple-600 hover:bg-purple-700">কুইজ আবার দিন</button>
            </div>
        </div>
    </div>

    <script>
        const questions = [
            {
                question: "পৃথিবীর বৃহত্তম মহাদেশ কোনটি?",
                options: ["ক) আফ্রিকা", "খ) এশিয়া", "গ) উত্তর আমেরিকা", "ঘ) ইউরোপ"],
                correct: "খ) এশিয়া"
            },
            {
                question: "নীল নদ কোন মহাদেশে অবস্থিত?",
                options: ["ক) এশিয়া", "খ) আফ্রিকা", "গ) ইউরোপ", "ঘ) দক্ষিণ আমেরিকা"],
                correct: "খ) আফ্রিকা"
            },
            {
                question: "হিমালয় পর্বতমালা কোন দুটি দেশের সীমান্তে অবস্থিত?",
                options: ["ক) ভারত ও পাকিস্তান", "খ) ভারত ও নেপাল", "গ) চীন ও রাশিয়া", "ঘ) বাংলাদেশ ও মায়ানমার"],
                correct: "খ) ভারত ও নেপাল"
            },
            {
                question: "সাহারা মরুভূমি কোন মহাদেশে অবস্থিত?",
                options: ["ক) এশিয়া", "খ) আফ্রিকা", "গ) অস্ট্রেলিয়া", "ঘ) দক্ষিণ আমেরিকা"],
                correct: "খ) আফ্রিকা"
            },
            {
                question: "বিশ্বের গভীরতম মহাসাগর কোনটি?",
                options: ["ক) আটলান্টিক মহাসাগর", "খ) ভারত মহাসাগর", "গ) প্রশান্ত মহাসাগর", "ঘ) সুমেরু মহাসাগর"],
                correct: "গ) প্রশান্ত মহাসাগর"
            },
            {
                question: "ভারতের দীর্ঘতম নদী কোনটি?",
                options: ["ক) যমুনা", "খ) ব্রহ্মপুত্র", "গ) গঙ্গা", "ঘ) গোদাবরী"],
                correct: "গ) গঙ্গা"
            },
            {
                question: "কোন গ্রহকে 'লাল গ্রহ' বলা হয়?",
                options: ["ক) শুক্র", "খ) মঙ্গল", "গ) বৃহস্পতি", "ঘ) শনি"],
                correct: "খ) মঙ্গল"
            },
            {
                question: "পৃথিবীর 'ছাদ' নামে পরিচিত কোন মালভূমি?",
                options: ["ক) দাক্ষিণাত্য মালভূমি", "খ) তিব্বত মালভূমি", "গ) পামির মালভূমি", "ঘ) ছোটনাগপুর মালভূমি"],
                correct: "গ) পামির মালভূমি"
            },
            {
                question: "কোন শহরকে 'গোলাপী শহর' বলা হয়?",
                options: ["ক) দিল্লি", "খ) মুম্বাই", "গ) জয়পুর", "ঘ) কলকাতা"],
                correct: "গ) জয়পুর"
            },
            {
                question: "বিশ্বের বৃহত্তম ব-দ্বীপ কোনটি?",
                options: ["ক) আমাজন ব-দ্বীপ", "খ) গঙ্গা-ব্রহ্মপুত্র ব-দ্বীপ", "গ) মিসিসিপি ব-দ্বীপ", "ঘ) ভলগা ব-দ্বীপ"],
                correct: "খ) গঙ্গা-ব্রহ্মপুত্র ব-দ্বীপ"
            },
            {
                question: "কোন পর্বতশ্রেণী ইউরোপ ও এশিয়াকে পৃথক করেছে?",
                options: ["ক) আল্পস", "খ) ইউরাল", "গ) রকি", "ঘ) আন্দিজ"],
                correct: "খ) ইউরাল"
            },
            {
                question: "'ভূমধ্যসাগরের চাবি' নামে পরিচিত কোন প্রণালী?",
                options: ["ক) সুয়েজ খাল", "খ) জিব্রাল্টার প্রণালী", "গ) পানামা খাল", "ঘ) মালাক্কা প্রণালী"],
                correct: "খ) জিব্রাল্টার প্রণালী"
            },
            {
                question: "বিশ্বের উচ্চতম জলপ্রপাত কোনটি?",
                options: ["ক) নায়াগ্রা জলপ্রপাত", "খ) ভিক্টোরিয়া জলপ্রপাত", "গ) অ্যাঞ্জেল জলপ্রপাত", "ঘ) ইগুয়াজু জলপ্রপাত"],
                correct: "গ) অ্যাঞ্জেল জলপ্রপাত"
            },
            {
                question: "কোন দেশ 'উদীয়মান সূর্যের দেশ' নামে পরিচিত?",
                options: ["ক) চীন", "খ) জাপান", "গ) ভারত", "ঘ) দক্ষিণ কোরিয়া"],
                correct: "খ) জাপান"
            },
            {
                question: "পৃথিবীর ফুসফুস' নামে পরিচিত কোন বনভূমি?",
                options: ["ক) সুন্দরবন", "খ) কঙ্গো রেইনফoreস্ট", "গ) আমাজন রেইনফoreস্ট", "ঘ) ব্ল্যাক ফরেস্ট"],
                correct: "গ) আমাজন রেইনফoreস্ট"
            },
            {
                question: "কোন দেশকে 'হাজার হ্রদের দেশ' বলা হয়?",
                options: ["ক) নরওয়ে", "খ) সুইডেন", "গ) ফিনল্যান্ড", "ঘ) কানাডা"],
                correct: "গ) ফিনল্যান্ড"
            },
            {
                question: "বিশ্বের বৃহত্তম দ্বীপ কোনটি?",
                options: ["ক) মাদাগাস্কার", "খ) বোর্নিও", "গ) গ্রিনল্যান্ড", "ঘ) নিউ গিনি"],
                correct: "গ) গ্রিনল্যান্ড"
            },
            {
                question: "কোন মহাদেশে একটিও মরুভূমি নেই?",
                options: ["ক) এশিয়া", "খ) ইউরোপ", "গ) আফ্রিকা", "ঘ) অস্ট্রেলিয়া"],
                correct: "খ) ইউরোপ"
            },
            {
                question: "ভারতের কোন রাজ্যকে 'মসলার বাগান' বলা হয়?",
                options: ["ক) কেরালা", "খ) কর্ণাটক", "গ) তামিলনাড়ু", "ঘ) অন্ধ্রপ্রদেশ"],
                correct: "ক) কেরালা"
            },
            {
                question: "বিশ্বের বৃহত্তম মিষ্টি জলের হ্রদ কোনটি?",
                options: ["ক) সুপিরিয়র হ্রদ", "খ) বৈকাল হ্রদ", "গ) ভিক্টোরিয়া হ্রদ", "ঘ) কাস্পিয়ান সাগর"],
                correct: "ক) সুপিরিয়র হ্রদ"
            }
        ];

        const quizForm = document.getElementById('quizForm');
        const submitQuizBtn = document.getElementById('submitQuiz');
        const quizResultsDiv = document.getElementById('quizResults');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const totalQuestionsDisplay = document.getElementById('totalQuestions');
        const answerFeedbackDiv = document.getElementById('answerFeedback');
        const retakeQuizBtn = document.getElementById('retakeQuiz');

        // Function to load questions
        function loadQuiz() {
            quizForm.innerHTML = '';
            answerFeedbackDiv.innerHTML = '';
            quizResultsDiv.classList.add('hidden');
            submitQuizBtn.style.display = 'block';
            totalQuestionsDisplay.textContent = questions.length;

            questions.forEach((q, index) => {
                const questionHtml = `
                    <div class="question-card">
                        <p class="question-text">${index + 1}. ${q.question}</p>
                        <div class="options-container">
                            ${q.options.map((option, optIndex) => `
                                <label class="option-label">
                                    <input type="radio" name="question${index}" value="${option}" class="option-input">
                                    ${option}
                                </label>
                            `).join('')}
                        </div>
                    </div>
                `;
                quizForm.innerHTML += questionHtml;
            });
        }

        // Function to call Gemini API for explanation
        async function getExplanation(questionText, correctAnswer, explanationElement, loadingIndicatorElement) {
            loadingIndicatorElement.textContent = 'ব্যাখ্যা লোড হচ্ছে...';
            loadingIndicatorElement.classList.add('show');
            explanationElement.classList.remove('show');
            explanationElement.textContent = ''; // Clear previous explanation

            const prompt = `Please explain the correct answer for the following Geography question in Bengali: "${questionText}" The correct answer is "${correctAnswer}". Provide a concise explanation.`;

            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });
            const payload = { contents: chatHistory };
            const apiKey = "" // Canvas environment will inject this for gemini-2.0-flash
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API call failed with status:', response.status, 'Response:', errorText);
                    explanationElement.textContent = `ব্যাখ্যা লোড করতে সমস্যা হয়েছে: ${response.status} ${response.statusText}`;
                    explanationElement.classList.add('show');
                    return; // Exit if response is not OK
                }

                const result = await response.json();
                console.log('Gemini API response:', result); // Log the full response for debugging

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    explanationElement.textContent = text;
                    explanationElement.classList.add('show');
                } else {
                    console.warn('Gemini API response structure unexpected or no content:', result);
                    explanationElement.textContent = 'ব্যাখ্যা পাওয়া যায়নি। (API প্রতিক্রিয়া অপ্রত্যাশিত)';
                    explanationElement.classList.add('show');
                }
            } catch (error) {
                console.error('Error fetching explanation (network/parsing):', error);
                explanationElement.textContent = 'ব্যাখ্যা লোড করতে সমস্যা হয়েছে। অনুগ্রহ করে আপনার ইন্টারনেট সংযোগ পরীক্ষা করুন।';
                explanationElement.classList.add('show');
            } finally {
                loadingIndicatorElement.classList.remove('show');
            }
        }

        // Function to calculate and display results
        function submitQuiz() {
            let score = 0;
            answerFeedbackDiv.innerHTML = ''; // Clear previous feedback

            questions.forEach((q, index) => {
                const selectedOption = document.querySelector(`input[name="question${index}"]:checked`);
                const questionCard = quizForm.children[index]; // Get the specific question card

                let isCorrect = false;
                let userAnswer = "উত্তর দেওয়া হয়নি"; // Default if no option selected

                if (selectedOption) {
                    userAnswer = selectedOption.value;
                    if (selectedOption.value === q.correct) {
                        score++;
                        isCorrect = true;
                    }
                }

                // Add feedback for each question
                const feedbackItem = document.createElement('div');
                feedbackItem.classList.add('feedback-item');
                feedbackItem.innerHTML = `
                    <p class="question-text-feedback">${index + 1}. ${q.question}</p>
                    <p class="${isCorrect ? 'text-green-700' : 'text-red-700'} font-semibold">আপনার উত্তর: ${userAnswer} <span class="${isCorrect ? 'text-green-500' : 'text-red-500'}">(${isCorrect ? 'সঠিক' : 'ভুল'})</span></p>
                    ${!isCorrect ? `<p class="correct-answer-text">সঠিক উত্তর: ${q.correct}</p>` : ''}
                    <button class="explain-button" data-question-index="${index}">✨ ব্যাখ্যা দেখুন</button>
                    <div class="loading-indicator"></div>
                    <div class="explanation-text"></div>
                `;
                answerFeedbackDiv.appendChild(feedbackItem);

                // Disable all radio buttons after submission
                const radios = questionCard.querySelectorAll('input[type="radio"]');
                radios.forEach(radio => radio.disabled = true);
            });

            // Attach event listeners to the new explain buttons
            document.querySelectorAll('.explain-button').forEach(button => {
                button.addEventListener('click', (event) => {
                    const questionIndex = event.target.dataset.questionIndex;
                    const questionData = questions[questionIndex];
                    const explanationElement = event.target.nextElementSibling.nextElementSibling; // The div after loading indicator
                    const loadingIndicatorElement = event.target.nextElementSibling; // The div after the button

                    getExplanation(questionData.question, questionData.correct, explanationElement, loadingIndicatorElement);
                });
            });

            scoreDisplay.textContent = score;
            quizResultsDiv.classList.remove('hidden');
            submitQuizBtn.style.display = 'none';
        }

        // Event Listeners
        submitQuizBtn.addEventListener('click', submitQuiz);
        retakeQuizBtn.addEventListener('click', loadQuiz);

        // Initial load of the quiz
        loadQuiz();
    </script>
</body>
</html>